<!-- Sidebar -->
<aside id="sidebar" class="fixed lg:static inset-y-0 right-0 z-50 w-64 bg-white shadow-xl border-l border-slate-200 transform translate-x-full lg:translate-x-0 transition-all duration-300 ease-in-out">
    <div class="flex flex-col h-full">
        <!-- Toggle Button -->
        <div class="hidden lg:flex items-center py-2 px-4 border-b border-slate-200" style="align-items: flex-end; justify-content: flex-end">
            <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-slate-100 text-slate-600 hover:text-slate-800 transition-all">
                <i class="fas fa-chevron-right text-xl"></i>
            </button>
        </div>
        <nav class="flex-1 overflow-y-auto px-4 py-6">
            <div class="space-y-2">
                <!-- Dashboard -->
                {% if user.user_type == 'representative' %}
                <a href="{% url 'base:rep_dashboard' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-slate-100 group-hover:bg-slate-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-home text-slate-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">لوحة التحكم</span>
                </a>
                {% else %}
                <a href="{% url 'base:dashboard' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-slate-100 group-hover:bg-slate-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-home text-slate-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">لوحة التحكم</span>
                </a>
                {% endif %}
                
        <!-- Separator -->
        <div class="border-b border-slate-200"></div>
                <!-- Products -->
                <a href="{% url 'base:products' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-green-50 hover:text-green-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-green-100 group-hover:bg-green-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-box text-green-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap flex-1">المنتجات</span>
                    <span class="sidebar-badge bg-green-100 text-green-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">{{ products_count }}</span>
                </a>
                
                <!-- Categories -->
                <a href="{% url 'base:categories' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-blue-50 hover:text-blue-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-blue-100 group-hover:bg-blue-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-tags text-blue-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap flex-1">الفئات</span>
                    <span class="sidebar-badge bg-blue-100 text-blue-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">{{ categories_count }}</span>
                </a>
                
                <!-- Inventory -->
                <a href="{% url 'base:inventory' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-green-50 hover:text-green-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-green-100 group-hover:bg-green-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-warehouse text-green-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">المخزون</span>
                </a>
                
        {% if user.user_type == 'accountant' %}
        <!-- Separator -->
        <div class="border-b border-slate-200"></div>
                <!-- Representatives (Accountant only) -->
                <a href="{% url 'base:representatives' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-purple-50 hover:text-purple-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-purple-100 group-hover:bg-purple-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-truck text-purple-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap flex-1">المندوبين</span>
                    <span class="sidebar-badge bg-purple-100 text-purple-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">{{ representatives_count }}</span>
                </a>
        {% endif %}
                
        <!-- Separator -->
        <div class="border-b border-slate-200"></div>
                <!-- Transactions -->
                {% if user.user_type == 'representative' %}
                <a href="{% url 'base:rep_transactions' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-teal-50 hover:text-teal-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-teal-100 group-hover:bg-teal-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-receipt text-teal-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">معاملاتي</span>
                </a>
                {% else %}
                <a href="{% url 'base:transactions' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-teal-50 hover:text-teal-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-teal-100 group-hover:bg-teal-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-receipt text-teal-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">المعاملات</span>
                </a>
                {% endif %}
                
                {% if user.user_type == 'accountant' %}
                <!-- Reports (Accountant only) -->
                <a href="{% url 'base:reports' %}" class="sidebar-link group flex items-center pl-4 pr-1 py-2 text-slate-700 rounded-lg hover:bg-pink-50 hover:text-pink-700 transition-all">
                    <div class="w-10 h-10 rounded-lg bg-pink-100 group-hover:bg-pink-200 flex items-center justify-center flex-shrink-0 transition-all">
                        <i class="fas fa-chart-bar text-pink-600"></i>
                    </div>
                    <span class="sidebar-text font-medium mr-3 whitespace-nowrap">التقارير</span>
                </a>
                {% endif %}
            </div>
        </nav>
        
        <!-- User Section -->
        <div class="border-t border-slate-200 p-4">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center text-white font-bold flex-shrink-0">
                    {{ user.username|make_list|first|upper }}
                </div>
                <div class="sidebar-text flex-1 min-w-0">
                    <p class="font-medium text-slate-800 truncate">{{ user.get_full_name|default:user.username }}</p>
                    <p class="text-xs text-slate-500">
                        {% if user.user_type == 'accountant' %}محاسب{% else %}مندوب{% endif %}
                    </p>
                </div>
            </div>
            <form method="post" action="{% url 'logout' %}" class="w-full">
                {% csrf_token %}
                <button type="submit" class="sidebar-link w-full flex items-center justify-center gap-2 px-4 py-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-all font-medium">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="sidebar-text">تسجيل الخروج</span>
                </button>
            </form>
        </div>
    </div>
</aside>

<script>
    // Sidebar toggle functionality
    const sidebarEl = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarTexts = document.querySelectorAll('.sidebar-text');
    const sidebarBadges = document.querySelectorAll('.sidebar-badge');
    
    // Check localStorage for saved state
    const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    
    // Apply saved state on load
    if (sidebarCollapsed) {
        collapseSidebar();
    }
    
    // Toggle sidebar on button click
    sidebarToggle?.addEventListener('click', () => {
        if (sidebarEl.classList.contains('w-64')) {
            collapseSidebar();
            localStorage.setItem('sidebarCollapsed', 'true');
        } else {
            expandSidebar();
            localStorage.setItem('sidebarCollapsed', 'false');
        }
    });
    
    function collapseSidebar() {
        sidebarEl.classList.remove('w-64');
        sidebarEl.classList.add('w-20');
        sidebarTexts.forEach(text => {
            text.classList.add('opacity-0', 'w-0', 'overflow-hidden');
        });
        sidebarBadges.forEach(badge => {
            badge.classList.add('opacity-0', 'w-0', 'overflow-hidden');
        });
        sidebarToggle.querySelector('i').classList.remove('fa-chevron-right');
        sidebarToggle.querySelector('i').classList.add('fa-chevron-left');
    }
    
    function expandSidebar() {
        sidebarEl.classList.remove('w-20');
        sidebarEl.classList.add('w-64');
        sidebarTexts.forEach(text => {
            text.classList.remove('opacity-0', 'w-0', 'overflow-hidden');
        });
        sidebarBadges.forEach(badge => {
            badge.classList.remove('opacity-0', 'w-0', 'overflow-hidden');
        });
        sidebarToggle.querySelector('i').classList.remove('fa-chevron-left');
        sidebarToggle.querySelector('i').classList.add('fa-chevron-right');
    }
    
    // Close sidebar on mobile
    document.getElementById('close-sidebar')?.addEventListener('click', () => {
        sidebarEl?.classList.add('translate-x-full');
        document.getElementById('mobile-overlay')?.classList.add('hidden');
    });
    
    // Active link highlighting
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.sidebar-link');
    
    navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('bg-slate-100', 'font-semibold', 'shadow-sm');
            link.querySelector('div').classList.add('shadow-md');
        }
    });
</script>
