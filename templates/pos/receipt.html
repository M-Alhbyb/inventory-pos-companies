<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>فاتورة #{{ sale.receipt_number }}</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            width: 80mm;
            margin: 0 auto;
            padding: 10px;
            text-align: center;
        }
        .header { margin-bottom: 20px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
        .details { text-align: right; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th { text-align: right; border-bottom: 1px solid #000; }
        td { text-align: right; padding: 5px 0; }
        .totals { text-align: right; margin-top: 10px; border-top: 1px dashed #000; padding-top: 10px; }
        .total-row { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 5px; }
        .footer { margin-top: 20px; font-size: 10px; border-top: 1px dashed #000; padding-top: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h2>{{ company.name }}</h2>
        <p>{{ company.phone }}</p>
        <p>فاتورة ضريبية مبسطة</p>
    </div>
    
    <div class="details">
        <div>رقم الفاتورة: {{ sale.receipt_number }}</div>
        <div>التاريخ: {{ sale.created_at|date:"Y-m-d H:i" }}</div>
        <div>الكاشير: {{ sale.cashier.username }}</div>
        {% if sale.customer_name %}
        <div>العميل: {{ sale.customer_name }}</div>
        {% endif %}
    </div>
    
    <table>
        <thead>
            <tr>
                <th>المنتج</th>
                <th>الكمية</th>
                <th>السعر</th>
                <th>الإجمالي</th>
            </tr>
        </thead>
        <tbody>
            {% for item in sale.items.all %}
            <tr>
                <td>{{ item.product.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.price }}</td>
                <td>{{ item.quantity|multiply:item.price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="totals">
        <div class="total-row"><span>المجموع الفرعي:</span> <span>{{ sale.subtotal }}</span></div>
        <div class="total-row"><span>الضريبة ({{ sale.tax_rate }}%):</span> <span>{{ sale.tax_amount }}</span></div>
        {% if sale.discount_amount > 0 %}
        <div class="total-row"><span>الخصم:</span> <span>-{{ sale.discount_amount }}</span></div>
        {% endif %}
        <div class="total-row" style="font-size: 14px; margin-top: 5px;">
            <span>الإجمالي النهائي:</span> <span>{{ sale.total }}</span>
        </div>
        
        <br>
        <div class="total-row"><span>المدفوع:</span> <span>{{ sale.amount_paid }}</span></div>
        <div class="total-row"><span>المتبقي:</span> <span>{{ sale.change }}</span></div>
        <div class="total-row"><span>طريقة الدفع:</span> <span>{{ sale.get_payment_method_display }}</span></div>
    </div>
    
    <div class="footer">
        <p>شكراً لتسوقكم معنا!</p>
        {% if company.tax_number %}
        <p>الرقم الضريبي: {{ company.tax_number }}</p>
        {% endif %}
    </div>
    
    <script>
        window.print();
    </script>
</body>
</html>
